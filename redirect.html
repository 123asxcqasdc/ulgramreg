<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîó –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .status {
            margin: 30px 0;
        }
        
        .spinner {
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .url-display {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
            word-break: break-all;
            font-family: monospace;
            font-size: 14px;
            border: 1px solid #e0e0e0;
        }
        
        .error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c00;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: left;
        }
        
        .error h3 {
            margin-bottom: 10px;
            color: #900;
        }
        
        .info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            color: #1565c0;
            padding: 15px;
            border-radius: 10px;
            margin-top: 25px;
            font-size: 14px;
            text-align: left;
        }
        
        .info h3 {
            margin-bottom: 10px;
            color: #0d47a1;
        }
        
        .info code {
            background: rgba(255,255,255,0.5);
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
            display: block;
            margin: 5px 0;
        }
        
        .footer {
            margin-top: 30px;
            color: #666;
            font-size: 12px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        
        .manual-redirect {
            margin-top: 20px;
        }
        
        .manual-redirect button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .manual-redirect button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîó –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç</h1>
        
        <div class="status">
            <div class="spinner"></div>
            <p>–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ...</p>
        </div>
        
        <div id="urlDisplay" class="url-display"></div>
        
        <div class="manual-redirect" id="manualRedirect" style="display: none;">
            <p>–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ –ø—Ä–æ–∏–∑–æ—à–µ–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
            <button onclick="redirectManually()">–ü–µ—Ä–µ–π—Ç–∏ –≤—Ä—É—á–Ω—É—é</button>
        </div>
        
        <div id="errorMessage" class="error" style="display: none;"></div>
        
        <div class="info">
            <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Å—ã–ª–∫–∏:</h3>
            <div id="paramsInfo"></div>
        </div>
        
        <div class="footer">
            Frontend Redirect Service ‚Ä¢ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
        function showParamsInfo(params) {
            const paramsInfo = document.getElementById('paramsInfo');
            let html = '';
            
            for (const [key, value] of params.entries()) {
                html += `<div><strong>${key}:</strong> <code>${value.substring(0, 100)}${value.length > 100 ? '...' : ''}</code></div>`;
            }
            
            paramsInfo.innerHTML = html;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è URL
        function showUrl(url) {
            const urlDisplay = document.getElementById('urlDisplay');
            try {
                const urlObj = new URL(url);
                urlDisplay.innerHTML = `
                    <strong>–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞:</strong><br>
                    <div style="color: #667eea; margin-top: 5px;">
                        ${urlObj.protocol}//${urlObj.hostname}${urlObj.pathname}
                    </div>
                    ${urlObj.search ? `<div style="font-size: 12px; color: #666; margin-top: 5px;">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: ${urlObj.search.substring(0, 50)}${urlObj.search.length > 50 ? '...' : ''}</div>` : ''}
                `;
            } catch {
                urlDisplay.innerHTML = `<strong>–°—Å—ã–ª–∫–∞:</strong><br>${url.substring(0, 100)}${url.length > 100 ? '...' : ''}`;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–∫–∏
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.style.display = 'block';
            errorDiv.innerHTML = `
                <h3>‚ùå –û—à–∏–±–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞</h3>
                <p>${message}</p>
                <p style="margin-top: 10px;"><strong>–ü—Ä–∏–º–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å—Å—ã–ª–∫–∏:</strong><br>
                <code>redirect.html?data=eyJ1cmwiOiJodHRwczovL2V4YW1wbGUuY29tIn0=</code></p>
            `;
            
            document.querySelector('.status').style.display = 'none';
            document.getElementById('manualRedirect').style.display = 'block';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è Base64 URL
        function decodeBase64Url(encoded) {
            try {
                // –î–µ–∫–æ–¥–∏—Ä—É–µ–º Base64
                const decoded = atob(encoded);
                
                // –ü—Ä–æ–±—É–µ–º —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON (–µ—Å–ª–∏ –∫–æ–¥–∏—Ä–æ–≤–∞–ª—Å—è –æ–±—ä–µ–∫—Ç)
                try {
                    const data = JSON.parse(decoded);
                    return data.url || decoded;
                } catch {
                    // –ï—Å–ª–∏ –Ω–µ JSON, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
                    return decoded;
                }
            } catch (error) {
                throw new Error('–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è Base64');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ URL
        function decodeSimpleUrl(encoded) {
            try {
                return decodeURIComponent(encoded);
            } catch {
                return encoded;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ URL
        function isSafeUrl(url) {
            try {
                const urlObj = new URL(url);
                
                // –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã
                const allowedProtocols = ['http:', 'https:', 'mailto:', 'tel:', 'sms:'];
                if (!allowedProtocols.includes(urlObj.protocol)) {
                    return false;
                }
                
                // –ë–ª–æ–∫–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∞–¥—Ä–µ—Å–∞
                const blockedHosts = [
                    'localhost',
                    '127.0.0.1',
                    '0.0.0.0',
                    '[::1]',
                    '192.168.',
                    '10.',
                    '172.16.',
                    '172.31.'
                ];
                
                const hostname = urlObj.hostname.toLowerCase();
                for (const blocked of blockedHosts) {
                    if (hostname.startsWith(blocked)) {
                        return false;
                    }
                }
                
                return true;
            } catch {
                return false;
            }
        }
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
        function performRedirect() {
            const params = new URLSearchParams(window.location.search);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
            showParamsInfo(params);
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            const encodedData = params.get('data') || params.get('url') || params.get('u') || params.get('link');
            
            if (!encodedData) {
                showError('–ù–µ —É–∫–∞–∑–∞–Ω–∞ —Å—Å—ã–ª–∫–∞ –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä ?data= –∏–ª–∏ ?url=');
                return;
            }
            
            let targetUrl;
            
            try {
                // –ü—Ä–æ–±—É–µ–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ Base64
                targetUrl = decodeBase64Url(encodedData);
            } catch {
                try {
                    // –ü—Ä–æ–±—É–µ–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ –ø—Ä–æ—Å—Ç–æ–π URL
                    targetUrl = decodeSimpleUrl(encodedData);
                } catch (error) {
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É: ' + error.message);
                    return;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å URL
            if (!isSafeUrl(targetUrl)) {
                showError('–°—Å—ã–ª–∫–∞ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª. –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ http://, https://, mailto:, tel:, sms:');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º URL –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            showUrl(targetUrl);
            
            // –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç
            setTimeout(() => {
                window.location.replace(targetUrl);
            }, 100); // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
        function redirectManually() {
            const params = new URLSearchParams(window.location.search);
            const encodedData = params.get('data') || params.get('url') || params.get('u') || params.get('link');
            
            if (encodedData) {
                try {
                    let targetUrl;
                    try {
                        targetUrl = decodeBase64Url(encodedData);
                    } catch {
                        targetUrl = decodeSimpleUrl(encodedData);
                    }
                    
                    if (targetUrl && isSafeUrl(targetUrl)) {
                        window.location.href = targetUrl;
                    }
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä—É—á–Ω–æ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç–µ: ' + error.message);
                }
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
            setTimeout(performRedirect, 50);
            
            // –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                const manualRedirect = document.getElementById('manualRedirect');
                if (manualRedirect.style.display !== 'block') {
                    document.querySelector('.status').innerHTML = `
                        <div style="color: #667eea; font-size: 24px; margin: 20px 0;">‚Üª</div>
                        <p>–ï—Å–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ –ø—Ä–æ–∏–∑–æ—à–µ–ª, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>
                    `;
                }
            }, 5000);
        });
    </script>
</body>
</html>
